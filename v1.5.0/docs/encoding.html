
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>String encoding and unicode issues &#8212; Dynatrace OneAgent and SDK for Python 1.5.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tagging" href="tagging.html" />
    <link rel="prev" title="oneagent-sdk API Reference" href="sdkref.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tagging.html" title="Tagging"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="sdkref.html" title="oneagent-sdk API Reference"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Dynatrace OneAgent and SDK for Python 1.5.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">String encoding and unicode issues</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="string-encoding-and-unicode-issues">
<span id="encoding"></span><h1>String encoding and unicode issues<a class="headerlink" href="#string-encoding-and-unicode-issues" title="Permalink to this heading">¶</a></h1>
<p>This section mostly concerns Python 2.</p>
<p>When the documentation says that a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> is accepted, an <code class="xref py py-class docutils literal notranslate"><span class="pre">unicode</span></code>
is also always accepted on Python 2. What is more, when the documentation says
that a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> is returned or passed to a callback, on Python 2 it is
actually a <code class="xref py py-class docutils literal notranslate"><span class="pre">unicode</span></code> (you mostly don’t need to care about that though,
because most string operations on Python 2 allow mixing <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> and
<code class="xref py py-class docutils literal notranslate"><span class="pre">unicode</span></code>).</p>
<p>When passing a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> object (or, equivalently, a <code class="code docutils literal notranslate"><span class="pre">str</span></code> object on
Python 2) to a SDK function that says that it accepts a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, the bytes
will be interpreted as being UTF-8 encoded. Beware: If the string has invalid
UTF-8 (e.g., Latin-1/ISO-8859-1, as it may occur in <a class="reference internal" href="#http-encoding-warning"><span class="std std-ref">HTTP headers</span></a>), the function to which it was passed may fail either
partially or fully. Such failures are guaranteed to neither throw exceptions nor
violate any invariants of the involved objects, but some or all of the
information passed in that function call may be lost (for example, a single
invalid HTTP header passed to
<a class="reference internal" href="sdkref.html#oneagent.sdk.SDK.trace_incoming_web_request" title="oneagent.sdk.SDK.trace_incoming_web_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">oneagent.sdk.SDK.trace_incoming_web_request()</span></code></a> may cause an null-tracer to
be returned – but it is also allowed to, for example, truncate that HTTP header
and discard all that follow; the exact failure mode is undefined and you should
take care to not pass invalid strings). Also, the diagnostic callback
(<a class="reference internal" href="sdkref.html#oneagent.sdk.SDK.set_diagnostic_callback" title="oneagent.sdk.SDK.set_diagnostic_callback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">oneagent.sdk.SDK.set_diagnostic_callback()</span></code></a>) may be invoked (but is not
guaranteed to).</p>
<section id="http-request-and-response-header-encoding">
<span id="http-encoding-warning"></span><h2>HTTP Request and Response Header Encoding<a class="headerlink" href="#http-request-and-response-header-encoding" title="Permalink to this heading">¶</a></h2>
<p>The strings passed to the <code class="code docutils literal notranslate"><span class="pre">add_request_header()</span></code>, <code class="code docutils literal notranslate"><span class="pre">add_request_headers()</span></code>,
<code class="code docutils literal notranslate"><span class="pre">add_parameter()</span></code>, <code class="code docutils literal notranslate"><span class="pre">add_parameters()</span></code>, <code class="code docutils literal notranslate"><span class="pre">add_response_header()</span></code> and
<code class="code docutils literal notranslate"><span class="pre">add_response_headers()</span></code> methods of the <a class="reference internal" href="sdkref.html#oneagent.sdk.tracers.IncomingWebRequestTracer" title="oneagent.sdk.tracers.IncomingWebRequestTracer"><code class="xref py py-class docutils literal notranslate"><span class="pre">oneagent.sdk.tracers.IncomingWebRequestTracer</span></code></a>
and <a class="reference internal" href="sdkref.html#oneagent.sdk.tracers.OutgoingWebRequestTracer" title="oneagent.sdk.tracers.OutgoingWebRequestTracer"><code class="xref py py-class docutils literal notranslate"><span class="pre">oneagent.sdk.tracers.OutgoingWebRequestTracer</span></code></a> classes follow the usual SDK
<a class="reference internal" href="#encoding"><span class="std std-ref">encoding</span></a> conventions, i.e., must be either unicode strings or UTF-8 bytes objects.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>However, <a class="reference external" href="https://tools.ietf.org/html/rfc7230#section-3.2.4">HTTP</a> and <a class="reference external" href="https://www.python.org/dev/peps/pep-3333/#unicode-issues">Python’s WSGI</a> will use the Latin-1 encoding on
Python 2. Before passing such Python 2 native strings to these methods, use
<code class="code docutils literal notranslate"><span class="pre">s.decode('Latin-1')</span></code> (see <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes.decode" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bytes.decode()</span></code></a>) to convert the string to unicode, which
can be correctly handled.</p>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">String encoding and unicode issues</a><ul>
<li><a class="reference internal" href="#http-request-and-response-header-encoding">HTTP Request and Response Header Encoding</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="sdkref.html"
                          title="previous chapter">oneagent-sdk API Reference</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="tagging.html"
                          title="next chapter">Tagging</a></p>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tagging.html" title="Tagging"
             >next</a> |</li>
        <li class="right" >
          <a href="sdkref.html" title="oneagent-sdk API Reference"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Dynatrace OneAgent and SDK for Python 1.5.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">String encoding and unicode issues</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Dynatrace LLC.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>